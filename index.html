<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>P-WORLD 機種抽出ツール</title>
  <link rel="stylesheet" href="./styles.css">
  <!-- Tesseract.js -->
  <script defer src="https://unpkg.com/tesseract.js@5.1.0/dist/tesseract.min.js"></script>
  <!-- XLSX.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- 自作スクリプト -->
  <script defer src="./normalize.js"></script>
  <script defer src="./ass.js"></script>
  <script defer src="./app.js"></script>
</head>
<body>
  <h1>P-WORLD 機種抽出</h1>

  <label>PDF選択:
    <input type="file" id="pdfFile" accept="application/pdf">
  </label>
  <br>
  <label>マスターCSV選択:
    <input type="file" id="masterFile" accept=".csv">
  </label>
  <br><br>

  <button id="ocrBtn" onclick="startOCR(); this.disabled=true;">OCR実行</button>
  <progress id="progress" max="100" value="0"></progress>
  <p id="status"></p>

  <script>
    async function startOCR() {
      const progress = document.getElementById("progress");
      const status = document.getElementById("status");
      progress.value = 0; // 進捗リセット
      status.textContent = "OCRを開始しました...";

      try {
        await runOCR(); // ass.js 側の処理を呼び出し
        status.textContent = "完了しました！";
      } catch (err) {
        console.error(err);
        status.textContent = "エラーが発生しました";
        document.getElementById("ocrBtn").disabled = false; // エラー時は再度有効化
      }
    }
  </script>
</body>
</html>
