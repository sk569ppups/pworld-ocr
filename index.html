<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>P-WORLD 機種抽出ツール（修正版・安全版）</title>

  <!-- 簡易スタイル -->
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; margin: 24px; line-height: 1.6; }
    h1 { font-size: 20px; margin-bottom: 12px; }
    .row { display: grid; grid-template-columns: 140px 1fr; gap: 12px; align-items: center; max-width: 720px; }
    .row + .row { margin-top: 10px; }
    .actions { margin: 16px 0; display: flex; gap: 12px; align-items: center; }
    button { padding: 10px 16px; border: 0; border-radius: 8px; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    progress { width: 300px; height: 16px; }
    #status { min-height: 1.4em; }
    .hint { font-size: 12px; opacity: .75; }
  </style>

  <!-- OCRライブラリ -->
  <!-- Tesseract.js v4 -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

  <!-- PDF.js (legacy版を利用) -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.2.67/legacy/build/pdf.min.js"></script>
  <script>
    window.addEventListener("load", () => {
      if (window.pdfjsLib) {
        window.pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.2.67/legacy/build/pdf.worker.min.js";
        console.log("pdfjsLib ready:", window.pdfjsLib);
      } else {
        console.error("pdfjsLib not found!");
      }
    });
  </script>

  <!-- アプリ本体 -->
  <script src="./app.js"></script>
</head>
<body>
  <h1>P-WORLD 機種抽出ツール（修正版・安全版）</h1>

  <div class="row">
    <label for="pdfFile">PDFファイル</label>
    <input type="file" id="pdfFile" accept="application/pdf" />
  </div>

  <div class="row">
    <label for="masterFile">マスターCSV</label>
    <input type="file" id="masterFile" accept=".csv" />
  </div>

  <div class="actions">
    <button id="ocrBtn" onclick="startOCR()">OCR実行</button>
    <progress id="progress" max="100" value="0"></progress>
  </div>

  <p id="status" aria-live="polite"></p>
  <p class="hint">※ XLSX.js が読み込めない環境では CSV を自動ダウンロードします。</p>
</body>
</html>
